{% extends "bootstrap/base.html" %}
{% block title %}Home{% endblock %}

{% block navbar %}
  <div class="navbar navbar-inverse" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle"
        data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">PyBlock</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Wallet Generator</a></li>
        <li><a href="/make/transaction">Make Transaction</a></li>
        <li><a href="/">View Transactions</a></li>
      </ul>
    </div>
  </div>
  </div>

{% endblock %}
{% block content %}
<div class="container">
  <div class="container">
     <div class="row">
       <div class="col-lg-12">

         <div class="card-body">
           <h4 class="card-title">View Transactions</h4>
           <p class="card-text">Enter a blockchain node URL and click on "View Transactions" button to check all transactions</p>
         </div>

       </div>
     </div>
   </div>

   <div class="container alert alert-secondary">

       <div class="row">
         <label class="col-sm-2">Node URL:</label>
         <div class="col-sm-10">
           <textarea id="node_url" rows="1" class="form-control">http://127.0.0.1:8888</textarea>
         </div>
       </div>

       <br>

       <div class="row">
         <div class="col-lg-12 text-center">
           <input type="button"  onclick="view_transactions()" id="view_transactions" class="btn btn-primary btn-lg" value="View Transactions">
         </div>
       </div>

   </div>

   <br>
   <!-- Blockchain Transactions Table -->
   <div class="container">
     <table id="transactions_table" class="table table-striped table-bordered" cellspacing="0" width="100%">
     </table>
   </div>
<script>
   async function view_transactions() {
     // TODO: change to node IP
     const res = await fetch("http://127.0.0.1:8888/chain");
     const data = await res.json();
     const transactions = [];
     console.log(data);
     /*
     for(let i = 1; i < data.length; i++) {
       for(let j = 0; j< data["chain"][i]["transactions"].length; j++) {
         var opts = {  year: "numeric", month: "short",  day: "numeric", hour: "2-digit", minute: "2-digit", second: "2-digit"  };
         var formattedDateTime = date.toLocaleTimeString("en-us", options);
         let transaction = [count,
                       response["chain"][i]["transactions"][j]["recipient_address"],
                       response["chain"][i]["transactions"][j]["sender_address"],
                       response["chain"][i]["transactions"][j]["value"],
                       formattedDateTime,
                       response["chain"][i]["block_number"]];
         transactions.push(transaction);
       }
     }
     console.table(transactions);
     */
     // TODO: Display transactions
   }
</script>
</div>
{% endblock %}
